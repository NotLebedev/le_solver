\documentclass[a4paper,12pt,titlepage,finall]{article}

\usepackage[T1,T2A]{fontenc}     % форматы шрифтов
\usepackage[utf8]{inputenc}      % кодировка символов, используемая в данном файле
\usepackage[russian]{babel}      % пакет русификации
\usepackage{tikz}                % для создания иллюстраций
\usepackage{pgfplots}            % для вывода графиков функций
\usepackage{geometry}		     % для настройки размера полей
\usepackage{indentfirst}         % для отступа в первом абзаце секции
\usepackage{amsmath,amsthm,amssymb}
\usepackage{mathtext}
\usepackage{graphicx}
\usepackage{hyperref}
\graphicspath{ {./} }

%Настройка листингов для языка C
\usepackage{xcolor}
\usepackage{listings}
\lstset{extendedchars=\true}

\definecolor{mGreen}{rgb}{0,0.6,0}
\definecolor{mGray}{rgb}{0.5,0.5,0.5}
\definecolor{mPurple}{rgb}{0.58,0,0.82}
\definecolor{backgroundColour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{CStyle}{
    backgroundcolor=\color{backgroundColour},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mPurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=none,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    language=C,
}

\lstdefinestyle{MakeStyle}{
    backgroundcolor=\color{backgroundColour},   
    commentstyle=\color{mGreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{mGray},
    stringstyle=\color{mPurple},
    basicstyle=\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=none,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    language=[gnu] make,
}

% выбираем размер листа А4, все поля ставим по 3см
\geometry{a4paper,left=30mm,top=30mm,bottom=30mm,right=30mm}

\setcounter{secnumdepth}{0}      % отключаем нумерацию секций
%\setcounter{tocdepth}{1}

\usepgfplotslibrary{fillbetween} % для изображения областей на графиках

\begin{document}
\begin{titlepage}
    \begin{center}
	{\small \sc Московский государственный университет \\имени М.~В.~Ломоносова\\
	Факультет вычислительной математики и кибернетики\\}
	\hrulefill
	\vfill
	{\large \bf Компьютерный практикум по учебному курсу}\\
	~\\
	{\Large \bf <<ВВЕДЕНИЕ В ЧИСЛЕННЫЕ МЕТОДЫ>>}\\ 
	~\\
	{\Large \bf ЗАДАНИЕ № 1}\\
	~\\
	{\large \bf ОТЧЕТ}\\
	{\bf о выполненном задании}\\
	{студента 201 учебной группы факультета ВМК МГУ}\\
	{Галустова Артемия Львовича}
    \end{center}
    
    \begin{center}
	\vfill
	{\small гор. Москва\\2020 год}
    \end{center}
\end{titlepage}

\tableofcontents
\newpage

\section{Подвариант 1}
\subsection{Цель работы}

Изучить классический метод Гаусса (а также модифицированный метод Гаусса),
применяемый для решения системы линейных алгебраических уравнений.

\subsection{Постановка задачи}

Дана система уравнений $Ax=f$ порядка $n \times n$ с невырожденной матрицей $A$. Написать
программу, решающую систему линейных алгебраических уравнений заданного
пользователем размера ($n$ – параметр программы) методом Гаусса и методом Гаусса с
выбором главного элемента.

\subsection{Цели и задачи практической работы}

\begin{enumerate}
\item
Решить заданную СЛАУ методом Гаусса и методом Гаусса с выбором главного
элемента;
\item
Вычислить определитель матрицы $det(A)$;
\item
Вычислить обратную матрицу $A^{-1}$;
\item
Определить число обусловленности $МA=||A|| \times ||A^{-1}||$;
\item
Исследовать вопрос вычислительной устойчивости метода Гаусса (при больших
значениях параметра $n$);
\item
Правильность решения СЛАУ подтвердить системой тестов (использован пакет символьных вычислений Wolfaram Mathematica).
\end{enumerate}

\newpage
\subsection{Описание метода решения}
Рассмотрим СЛАУ вида
\begin{align*}
\begin{cases}
a_{11} x_1 + a_{12} x_2 + ... + a_{1n} x_n = f_1\\
a_{21} x_1 + a_{22} x_2 + ... + a_{2n} x_n = f_2\\
...\\
a_{n1} x_1 + a_{n2} x_2 + ... + a_{nn} x_n = f_n\\
\end{cases}
\end{align*}
\par
Которая соответствует матричному представлению $A \times x = f$, где $A = (a_{ij}), f = (f_1, f_2, ... f_n)^T$ и $|A| \neq 0$. Поиск решения методом Гаусса, как с выбором главного элемента, так и без, состоит из двух основных этапов: прямой ход, приведению матрицы к треугольному виду виду; обратный ход, последовательное нахождение $x_n, x_{n - 1}, ... x_1$. Опишем подробнее данные этапы.
\par
Прямой ход метода Гаусса осуществляется следующим образом. В первой строке матрицы системы выбирается либо первый ненулевой, в случае обычного метода Гаусса, либо наибольший по модулю, в случае метода с выбором главного элемента, элемент. Такой ненулевой элемент обязательно найдётся в силу невырожденности матрицы. Затем столбцы расширенной матрицы переставляются так, чтобы выбранный элемент был в первом столбце. Это возможно реализовать явной перестановкой столбцов матрицы и перенумерованием переменных, однако это неэффективно, т.к. требует обмена значений $n$ чисел на каждом шаге. В представленной реализации сохраняется дополнительный массив, указывающий порядок выбора столбцов на каждом шаге прямого хода. Не ограничивая общности, можно считать, что такой элемент находится в первом столбце. Затем из всех последующих строк расширенной матрицы вычитается первая, домноженная на коэффициент $\frac{a_{1k}}{a_{11}}, k = 2 .. n$. Получается система
\begin{equation*}
\left\{
\begin{alignedat}{3}
a_{11} x_1 + &a_{12} x_2 &+ ... + a_{1n} x_n & = f_1\\
           &a'_{22} x_2 &+ ... + a'_{2n} x_n & = f'_2\\
&...&&\\
           &a'_{n2} x_2 &+ ... + a'_{nn} x_n & = f'_n\\
\end{alignedat}
\right.
\end{equation*}
\\
где $a'_{ij} = a_{ij} - a_{i1} \frac{a_{1j}}{a_{11}}, f'_i = f_i - a_{i1} \frac{f_1}{a_{11}}$. Далее указанные преобразования аналогично повторяются для второй, третей и т.д. строк. В итоге по результатам прямого хода получается система с верхнетреугольной матрицей. Т.к. осуществлялись только сложения строк с коэффициентом, то данная система эквивалентна изначальной. Представление в виде системы уравнений:
\begin{equation*}
\left\{
\begin{alignedat}{3}
&c_{11} x_1 + & c_{12} x_2 + ... +&c_{1 n-1} x_{n-1} +     &c_{1n} x_n    & = g_1\\
  &           & c_{22} x_2 + ... +&c_{2 n-1} x_{n-1} +     &c_{2n} x_n    & = g_2\\
&&...&&&\\
&             &                   &c_{n - 1 n-1} x_{n-1} + &c_{n-1 n} x_n & = g_{n-1}\\
 &            &                   &                        &c_{nn} x_n    & = g_n\\
\end{alignedat}
\right.
\end{equation*}
\par
Обратный ход метода Гаусса осуществляется над полученной при прямом ходе системой с учётном перестановки столбцов. Корни уравнения находятся в обратном порядке с использованием найденных ранее по формуле $x_k = c^{-1}_{kk} (g_k - c_{k k+1}x_{k+1} - c_{k k+2}x_{k+2} + ... + - c_{k n}x_n)$. Заметим, что $c_{kk} \neq 0$ т.к. выбирается ненулевым во время прямого хода.

\subsection{Вычисление определителя матрицы}
Воспользовавшись прямым ходом метода Гаусса, описанным выше, можно получить верхнетреугольную матрицу с точностью до перестановки столбцов. Тогда для вычисления определителя достаточно перемножить элементы соответствующие диагональным и домножить на $(-1)^{N(p)}$, где $N(p)$ -- число инверсий в перестановке порядка столбцов.
\subsection{Вычисление обратной матрицы}
Обратную матрицу вычислим по методу Гаусса-Жордана. В приведенном выше методе Гаусса (без выбора главного элемента) сделаем изменение. В случае, если диагональный элемент 0 будем обменивать строки а не столбцы и обменивать в явном виде. Также на каждом шаге будем нормализовать текущую строку, т.е. делить строку на диагональный элемент. Тогда применение к расширенной матрице $(A|I)$ метод Гаусса с указанными модификациями дважды,  в прямом и "обратном" направлении, получим матрицу $(I|A^{-1})$, правая часть этой расширенной матрицы и содержит обратную матрицу.
\subsection{Вычисление числа обусловленности}
Для вычисления числа обусловленности воспользуемся нормой $||A||_l = \max\limits_{1 \leq i \leq n} \sum\limits_{j=1}^n |a_{ij}|$. Тогда число обусловленности СЛАУ $M_A=||A|| \cdot ||A^{-1}||$, где обратную матрицу можно вычислить приведённым выше методом.
\subsection{Описание программы}
Данный алгоритм был реализован на языке С с применением стандартной библиотеки языка С. Ниже приведена часть файла algs.c содержащая реализацию описанных выше методов. Полный код программы доступен в разделе <<\nameref{source}>>, а также оналайн по адресу \url{https://github.com/NotLebedev/le_solver}.
\lstinputlisting[style=CStyle, firstline=16]{../algs.c}
\subsection{Тестирование}
Для проверки результатов выполнения программы на тестах был использован пакет символьных вычислений Wolfram Mathematica. Для проверки решений уравнений использовалась системная функция $LinearSolve$, $Det$ для вычисления определителя, $Inverse$ для вычисления обратной матрицы. Для Нахождения числа обусловленности была использована функция $cond[a\_] := Norm[Transpose[a], 1]*Norm[Transpose[Inverse[a]], 1]$. Погрешность вычислений проверялась при помощи функции $EuclidianDistance$, т.е. находилось расстояние между векторами решений и обратными матрицами, найденными программой и Wolfram Mathematica.
\begin{enumerate}
\item
Матрица системы
\begin{align*}
A = \begin{pmatrix}
2&  2&  -1&  1 \\
4&  3&  -1&  2 \\
8&  5&  -3&  4 \\
3&  3&  -2&  4 \\
\end{pmatrix}
\end{align*}
Столбец свободных членов
\begin{align*}
f = \begin{pmatrix}
4 \\
6 \\
12 \\
6 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса:
\begin{align*}
x = \begin{pmatrix}
0.60000 \\
   1.00000 \\
  -1.00000 \\
  -0.20000 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса с выбором главного элемента
\begin{align*}
x = \begin{pmatrix}
0.60000 \\
   1.00000 \\
  -1.00000 \\
  -0.20000 \\
\end{pmatrix}
\end{align*}
Обратная матрица
\begin{align*}
A^{-1} = \begin{pmatrix}
-0.60000&     0.10000&     0.30000&    -0.20000 \\
   1.00000&     0.50000&    -0.50000&     0.00000 \\
  -1.00000&     1.50000&    -0.50000&     0.00000 \\
  -0.80000&     0.30000&    -0.10000&     0.40000 \\
\end{pmatrix}
\end{align*}
Определитель вычисленный без выбора главного элемента  $\Delta = 10.000000$\\
Оперделитель вычисленный с выбором главного элемента $\Delta = 10.000000$\\
Число обусловленности $M_A = 60.000000$\\
Погрешность всех величин не превосходит $3 \times 10^{-16}$.
\item
Матрица системы
\begin{align*}
A = \begin{pmatrix}
1&     1&     3&    -2 \\
   2&     2&     4&    -1 \\
   3&     3&     5&    -2 \\
   2&     2&     8&    -3 \\
\end{pmatrix}
\end{align*}
Столбец свободных членов
\begin{align*}
f = \begin{pmatrix}
1 \\
2 \\
1 \\
2 \\
\end{pmatrix}
\end{align*}
Определитель вычисленный без выбора главного элемента  $\Delta = 0$\\
Оперделитель вычисленный с выбором главного элемента $\Delta = 0$\\
Матрица системы вырождена, это подтверждается Wolfram Mathematica.
\item
Матрица системы
\begin{align*}
A = \begin{pmatrix}
2&           5&          -8&           3 \\
         4&           3&          -9&           1 \\
         2&           3&          -5&          -6 \\
         1&           8&          -7&           0 \\
\end{pmatrix}
\end{align*}
Столбец свободных членов
\begin{align*}
f = \begin{pmatrix}
8 \\
         9 \\
         7 \\
        12 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса:
\begin{align*}
x = \begin{pmatrix}
3.00000 \\
   2.00000 \\
   1.00000 \\
   0.00000 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса с выбором главного элемента
\begin{align*}
x = \begin{pmatrix}
3.00000 \\
   2.00000 \\
   1.00000 \\
   0.00000 \\
\end{pmatrix}
\end{align*}
Обратная матрица
\begin{align*}
A^{-1} = \begin{pmatrix}
  -1.71958&     1.22222&    -0.65608&     0.86243 \\
  -0.65079&     0.33333&    -0.26984&     0.50794 \\
  -0.98942&     0.55556&    -0.40212&     0.56085 \\
  -0.07407&     0.11111&    -0.18519&     0.07407 \\
\end{pmatrix}
\end{align*}
Определитель вычисленный без выбора главного элемента  $\Delta = -189.000000$\\
Оперделитель вычисленный с выбором главного элемента $\Delta = -189.000000$\\
Число обусловленности $M_A = 80.285714$\\
Погрешность решений и определителей не превосходит $2 \times 10^{-17}$.\\
Погрешность обратной матрицы и числа обусловленности не превосходит $10^{-6}$.

\item
Матрица системы
\begin{align*}
A = \begin{pmatrix}
0&     0&     0&    65&     0 \\
   4&     9&     1&     7&    10 \\
   3&    27&     8&     1&     1 \\
   7&    32&     1&    61&     0 \\
   4&    69&     2&     0&    45 \\
\end{pmatrix}
\end{align*}
Столбец свободных членов
\begin{align*}
f = \begin{pmatrix}
   0 \\
  65 \\
  23 \\
  11 \\
   3 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса:
\begin{align*}
x = \begin{pmatrix}
13.61231 \\
  -2.85385 \\
   7.03716 \\
   0.00000 \\
   2.91983 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса с выбором главного элемента
\begin{align*}
x = \begin{pmatrix}
  13.61231 \\
  -2.85385 \\
   7.03716 \\
   0.00000 \\
   2.91983 \\
\end{pmatrix}
\end{align*}
Обратная матрица
\begin{align*}
A^{-1} = \begin{pmatrix}
  -0.07755&     0.20936&    -0.02203&     0.05897&    -0.04604 \\
  -0.01466&    -0.04823&     0.00071&     0.02114&     0.01070 \\
   0.07336&     0.07777&     0.13149&    -0.08925&    -0.02021 \\
   0.01538&     0.00000&     0.00000&     0.00000&     0.00000 \\
   0.02610&     0.05188&    -0.00498&    -0.03369&     0.01080 \\
\end{pmatrix}
\end{align*}
Определитель вычисленный без выбора главного элемента  $\Delta = 3200925.000000$\\
Оперделитель вычисленный с выбором главного элемента $\Delta = 3200925.000000$\\
Число обусловленности $M_A = 49.673854$\\
Погрешность решений и определителей не превосходит $2 \times 10^{-17}$.\\
Погрешность обратной матрицы и числа обусловленности не превосходит $10^{-6}$.

\item
Матрица размером $n \times n, n = 30$ задаётся по формуле
\begin{align}
A_{ij} = \left\{
\begin{array}{ll}
\frac{i+j}{m+n}, i \neq j\\
n + m^2 + \frac{j}{m} + \frac{i}{m}, i = j
\end{array}
\right.
\end{align}
где $1 \leq i,j \leq n; m = 20$. А столбец свободных членов по формуле $f_i = mi + n$. Приведём также часть решения полученного программой и числовые характеристики.
Решение найденное методом Гаусса:
\begin{align*}
x = \begin{pmatrix}
0.05067 \\
   0.09618 \\
   0.14169 \\
   0.18718 \\
   ...\\
   1.27629 \\
   1.32155 \\
   1.36681 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса с выбором главного элемента
\begin{align*}
x = \begin{pmatrix}
  0.05067 \\
   0.09618 \\
   0.14169 \\
   0.18718 \\
   ...\\
   1.27629 \\
   1.32155 \\
   1.36681 \\
\end{pmatrix}
\end{align*}
Обратная матрица
\begin{align*}
A^{-1} = \begin{pmatrix}
    0.00233&    -0.00000&    -0.00000& ... &0.00000\\
   -0.00000&     0.00233&    -0.00000& ... &0.00000\\
   -0.00000&    -0.00000&     0.00232& ... &0.00000\\
   ...\\
   -0.00000&    -0.00000&    -0.00000& ... &0.00231\\
\end{pmatrix}
\end{align*}
Определитель матрицы этой системы при любом вычислении получается большим $\Delta = 1.09699 \times 10^79$.\\
Число обусловленности $M_A = 1.116706$\\
Точность вычислений для этой матрицы существенно хуже чем для предыдущих, порядка $10^{-6}$ для всех величин, кроме определителя, его погрешность $1.61243 \times 10^{67}$, однако, относительная погрешность тоже порядка $10^{-6}$.
\item
Матрица размером $n \times n, n = 100$ задаётся по формуле
\begin{align}
A_{ij} = \left\{
\begin{array}{ll}
\frac{i+j}{m+n}, i \neq j\\
\frac{n + m^2 + \frac{j}{m} + \frac{i}{m}}{400}, i = j
\end{array}
\right.
\end{align}
где $1 \leq i,j \leq n; m = 30$. А столбец свободных членов по формуле $f_i = mi + n$. Приведём также часть решения полученного программой и числовые характеристики.
\begin{align*}
x = \begin{pmatrix}
171.94735 \\
 170.51866 \\
 169.07228 \\
   ...\\
-166.23950 \\
-174.93024 \\
-183.88983 \\
\end{pmatrix}
\end{align*}
Решение найденное методом Гаусса с выбором главного элемента
\begin{align*}
x = \begin{pmatrix}
171.94735 \\
 170.51866 \\
 169.07228 \\
   ...\\
-166.23950 \\
-174.93024 \\
-183.88983 \\
\end{pmatrix}
\end{align*}
Обратная матрица
\begin{align*}
A^{-1} = \begin{pmatrix}
    0.38147&    -0.01837&    -0.01822& ... &     0.02038 \\
	0.01837&     0.38424&    -0.01806& ... &     0.02004 \\
	0.01822&    -0.01806&     0.38704& ... &     0.01971 \\
	...\\
	0.02038&     0.02004&     0.01971& ... &     0.95021 \\
\end{pmatrix}
\end{align*}
Определитель матрицы этой системы при любом вычислении получается большим $\Delta = -6.06825 \times 10^24$.\\
Число обусловленности $M_A = 320.755833$\\
Из-за плохой обусловленности матрицы системы возросли и погрешности. Погрешности порядка $10^{-3}$, кроме определителя, абсолютная погрешность составляет $2 \times 10^{17}$, относительная порядка $5 \times 10^{-8}$.
\end{enumerate}
\subsection{Выводы}
При выполнении поставленных целей был подробно разобран и реализован метод Гаусса. Даже с некоторыми оптимизациями метод прост для реализации и отладки. Вычисление решений для систем небольшого порядка очень удобно, т.к. метод работает за фиксированное время и обладает достаточной для таких случаев точностью. При необходимости решать плохо обусловленные системы больших размеров данный метод выдаёт гораздо меньшую точность, проявляя вычислительную неустойчивость.

\newpage
\section{Полный листинг программы} \label{source}

\subsection{Файл main.c}
\lstinputlisting[style = CStyle]{../main.c}
\subsection{Файл algs.h}
\lstinputlisting[style = CStyle]{../algs.h}
\subsection{Файл algs.c}
\lstinputlisting[style = CStyle]{../algs.c}
\subsection{Файл matrix.h}
\lstinputlisting[style = CStyle]{../matrix.h}
\subsection{Файл matrix.c}
\lstinputlisting[style = CStyle]{../matrix.c}
\subsection{Файл relaxation.h}
\lstinputlisting[style = CStyle]{../relaxation.h}
\subsection{Файл relaxation.c}
\lstinputlisting[style = CStyle]{../relaxation.c}
\subsection{Файл error.h}
\lstinputlisting[style = CStyle]{../error.h}
\end{document}